---
title: "Effects of bariatric surgery and weight loss on resting state functional connectivity"
author:
- Hannah Sophie Heinrichs* [1]
- Frauke Beyer* [1][2]
- Kerstin Prehn
- Agnes Floel
- Arno Villringer [1][2][3]
- A. Veronica Witte [1][2][3]
date: 1 Max-Planck-Institute for Human Cognitive and Brain Sciences, Leipzig \newline
  2 CRC 1052 "Obesity Mechanisms", Subproject A1, University of Leipzig \newline 3
  Day Clinic for Cognitive Neurology, University Clinic Leipzig
output:
  bookdown::pdf_book:
    fig_caption: yes
    always_allow_html: true
    number_sections: yes
    toc: yes
    extra_dependencies: "subfig"
bibliography: "bibliography.bib"
editor_options:
  
  chunk_output_type: console
header-includes:
- \usepackage[left]{lineno}
- \linenumbers
---

```{r "To do", include=FALSE}

# [ ] Evaluate SPM model comparison (more activation in SPM..)
# [ ] Discussion
# [ ] brain images mit nilearn plotting tools einbinden
# [ ] Upload auf Neurovolt, cf. cobidas reporting guidelines
# [ ] repeat analysis with exclusion of 10% of worst data ??
# [ ] Network tests
# [ ] Swap mFD with logmFD ??

```

```{r "load packages", include=FALSE}

# load packages
library(car) # version 3.0.9
library(plyr) # version 1.8.6
library(dplyr) # version 1.0.2
library(tidyr) # version 1.1.2
library(kableExtra) # version 1.2.1
library(ggplot2) # version 3.3.2
library(patchwork) # version 1.0.1; API for sequentially building up a plot (similar to gridExtra and cowplot)
library(cowplot)
library(RColorBrewer) # version 1.1.2
library(psych) # version 2.0.8

#library(lsr)
library(wesanderson) # colour palette
#library(haven)

library(lme4)

library(sjPlot) #only works for HTML output
library(texreg) #works for Rmarkdown
library(knitr) # version 1.30

```

```{r "knit setup", include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE) # fig.height=2, fig.width=4)
options(knitr.table.format = "latex")
options(knitr.kable.NA = '') # hide NA in tables
# set working directory of knit (RMarkdown) to directory of Rproj
#opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
#setwd(knitr::opts_knit$get("root.dir"))

```

\newpage
# Methods

```{r "Load data", include=FALSE}
#final <- create_sample_df(group = "both", tp = "all")
final <- read.csv(file = "../report/final.csv")

# indices of first row of each subject
subj_df <- final[match(unique(final$subj.ID), final$subj.ID),] # df with unique subjects

# completed time points
freqtable <- as.data.frame(table(final$subj.ID))
tpfreq <- table(freqtable$Freq)

# distribution of condition and sex
subj_df$Sex <- plyr::mapvalues(subj_df$Sex, from = c("-1", "1"), to = c("f", "m"))
cs <- addmargins(table(subj_df$Sex,subj_df$condition))

dfw <- tidyr::pivot_wider(data = final,
                          id_cols = c("subj.ID","condition","Sex","Age_BL"),
                          names_from = "tp",
                          values_from = c("BMI","meanFD"))
```

```{r "tableSample", echo=FALSE}
#tableSample <- mk_SampleTable(final)
tableSample <- readRDS(file = "../report/tab/tableSample.rds")

tab <-
  knitr::kable(
    tableSample,
    row.names = TRUE,
    format = "latex",
    booktabs = T,
    linesep = "",
    caption = "Distribution of data points at months after intervention")
tab
```

## Sample and study design

<!-- STUDY DESIGN --> The ADIPOSITAS-Study conducted in the Charité Berlin is a observational, prospective and longitudinal design described in detail by @Prehn_2020. Data collection is still ongoing but only data available in April 2019 is used.
The procedures followed were in accordance with the Helsinki Declaration. This study was registered at clinicaltrials.gov as NCT01554228 and described in more detailed in the preregistration under [https://osf.io/yp42s](https://osf.io/yp42s). <!-- previous version: https://osf.io/f8tpn, update: https://osf.io/59bh7/ -->
```{r tableDescr, echo=FALSE}
# table for descriptive statistics
tableDescr <- readRDS(file = "../report/tab/tableDescr.rds")

knitr::kable(
    tableDescr,
    row.names = FALSE,
    format = "latex",
    booktabs = T,
    linesep = "",
    caption = "BMI and mean FD of participants acquired in each condition and time point")
```
<!-- RECRUITEMENT, INCLUSION/EXCLUSION CRITERIA --> Participants were recruited from the Center for Bariatric and Metabolic Surgery if they were between age $18$ and $70$ and fulfilled the inclusion criteria. These were, in accordance with BARS guidelines, a failure of conservative obesity treatment and either (1) a BMI $> 40$ km/m$^2$ or (2) a BMI $> 35$ kg/m$^2$ and at least one typical co-morbidity (e.g. type-2 diabetes, hypertension, non-alcoholic fatty liver disease)[@Mechanick_2013].
Participants with a history of cancer, chronic inflammatory disease and addiction, other severe untreated diseases, brain pathologies identified in the MRI scan or cognitive impairments (MMSE score $< 34$) were excluded from the study.
Measures were taken at baseline (BL), $6$ (FU1) and $12$ (FU2) months post-surgery or after the baseline appointment but not all participants have complete data for all time points (see Table \@ref(tab:tableDescr)). `r sum(freqtable$Freq == 3)` participants had complete data, `r sum(freqtable$Freq == 2)` provided data for two time points and `r sum(freqtable$Freq == 1)` for only one time point.
The current sample is the subsample of $69$ subjects that were originally enrolled in the study entailing only subjects that have received MRI. Analyses were performed on all participants that provided at least one data point of fMRI data (detailed information on data availability in \@ref(tab:tableSample)).

<!-- DESCRIPTIVE STATISTICS --> The final sample entailed morbidly obese individuals 
(n = `r nrow(subj_df)`, 
`r nrow(filter(subj_df,Sex == "f"))` female; 
`r round(mean(subj_df$Age_BL),2)` 
$\pm$ `r round(sd(subj_df$Age_BL),2)` SD years old
(range `r min(subj_df$Age_BL)`-`r max(subj_df$Age_BL)`), 
that either underwent surgery 
(n = `r cs["Sum","IG"]`, 
`r cs["f","IG"]` female, 
`r round(mean(subj_df$Age_BL[subj_df$condition == "IG"]),2)` 
$\pm$ `r round(sd(subj_df$Age_BL[subj_df$condition == "IG"]),2)` SD years old) 
or were waiting list controls 
(n = `r cs["Sum","KG"]`, 
`r cs["f","KG"]` female,
`r round(mean(subj_df$Age_BL[subj_df$condition == "KG"]),2)`
$\pm$ `r round(sd(subj_df$Age_BL[subj_df$condition == "KG"]),2)` SD years old) 
The study design was quasi-experimental, as patient in the waiting control list had also been recommended to undergo bariatric surgery, but were still waiting for their health insurance's approval.
```{r tableBaselineCharacteristics, include=FALSE}
#dfBL <- create_sample_df(group = "all", tp = "BL")
dfBL <- readRDS(file = "../report/dfBL.rds")

# distributions per group
# BMI
p <- ggplot(data=dfBL, aes(group = condition, x=BMI, fill=condition)) +
  geom_density(alpha=0.6) +
  scale_fill_manual(
    values = c("#00305E77", "#C0004577"),
    labels = c("intervention", "control")) +
  theme_bw()
# log mean FD
p <- ggplot(data=dfBL, aes(group = condition, x=logmFD, fill=condition)) +
  geom_density(alpha=0.6) +
  scale_fill_manual(
    values = c("#00305E55", "#C0004555"),
    labels = c("intervention", "control")) +
  theme_bw()
# Age
p <- ggplot(data=dfBL, aes(group = condition, x=Age_BL, fill=condition)) +
  geom_density(alpha=0.6) +
  scale_fill_manual(
    values = c("#00305E77", "#C0004577"),
    labels = c("intervention", "control")) +
  theme_bw()

tab_age <- psych::describeBy(data=dfBL, x=dfBL$Age_BL, group=dfBL$condition, mat=T)

# Sex
p <- ggplot(data = dfBL, aes(x = condition, fill = Sex)) +
  geom_bar(position = "dodge") +
  scale_fill_manual(labels = c("female", "male"),
                    values = c("#00305E55", "#C0004555")
  )
tab_sex <- table(dfBL$condition, dfBL$Sex)
```

```{r figBMIdescr, fig.align='center', out.width="90%", fig.cap="BMI over time.", echo=FALSE}
# eval = TRUE, fig.asp = 0.7, fig.width = 6
readRDS(file = "../report/fig/fig_BMIdescr.rds")
```
<!-- BASELINE CHARACTERISTICS --> Histograms on baseline characteristics revealed, that patients in the control group did not differ notably from the intervention group regarding BMI and log mean FD, and only slightly in distribution of sex and age, the control group had a higher number of male participants (n = `r tab_sex[2,2]` vs. n = `r tab_sex[2,1]`) and a higher mean age (`r round(tab_age$mean[tab_age$group1=="KG"],2)` vs. `r round(tab_age$mean[tab_age$group1=="IG"],2)`). Change in BMI throughout the study is depicted in \@ref(fig:figBMIdescr).
<!-- SURGICAL PROCEDURE --> As intervention, $0$ participants received surgery that combines restrictive and malabsorptive mechanisms (RYGB) and $0$ surgery purely restricting energy intake (VSG: n = $0$, GB: n = $0$).
<!-- STUDY PROCEDURE --> Subjects arrived in the morning (between 07:00 and 12:00) after an overnight fast. They underwent medical assessments including an interview, blood draw and anthropocentric measurements before having a one our break for <!-- standadized??  -->breakfast. MRI scanning was done after further psychological tests (for details see @Prehn_2020).

## fMRI acquisition

MRI images were retrieved with a 12-channel head coil of a 3 Tesla Trio, Siemens (Erlangen) with syngo B17 software.
<!-- MRI --> T1-weighted anatomical images were acquired as described in @Prehn_2020 (with MPRAGE, repetition time (TR) = 1900 ms, echo time (TE) = 2.52 ms, flip angle = 9°, voxel size = 1 x 1 x 1 mm$^3$, 192 sagital slices).
<!-- rsfMRI --> Resting state echo-planar imaging  was acquired with a TR of 2.3 s and TE of 30 ms. The image matrix was 64 x 64 with an in-plane resolution of 3 mm x 3 mm and 34 slices with a slice thickness of 4 mm. 150 volumes were acquired, resulting in a total acquisition time of 5:45 minutes. Additionally, a gradient echo field map with a TE difference of 2.46 ms was acquired to correct for field inhomogeneties.
Participants were instructed to close their eyes but to remain awake during scanning.

## Pre-proceessing

Imaging data was conducted using AFNI 19.1.05, ANTS '2.3.1', FSL '6.0.1' and FreeSurfer '6.0.0p1', wrapped in a nipype workflow (version 1.2.0) in Python 2.7.15.
The preprocessing workflow included modules to process anatomical, functional and diffusion-weighted imaging in parallel. The workflow can be found on [github](https://github.com/fBeyer89/ADI_preproc/).

### Anatomical preprocessing
Within the module for anatomical preprocessing, the T1-weighted images were first processed by FreeSurfer's cross-sectional pipeline [@fs_cross]. Then, Freesurfer's longitudinal stream was applied to all cross-sectional runs [@fs_long]. Here, white matter (WM) and cerebral spinal fluid (CSF) masks were derived based on FreeSurfer's `aseg.mgz` segmentation file for quality control of rs preprocessing.  
The skull-stripped brain (`brainmask.mgz`) was then coregistered to the MNI152 1x1x1x mm template using ANTS [@antsref]. The following parameters were used for rigid [metric: mutual information, number of iterations: [1000, 500, 250, 100]], affine [metric: mutual information, number of iterations: [1000, 500, 250, 100]] and SyN: [metric: cross-correlation, iterations: [100, 70, 50, 20]] registration steps with shrink factors [8, 4, 2, 1], and smoothing sigmas=[3, 2, 1, 0] for each step.
In the preregistration it was only mentioned that longitudinal FreeSurfer would be used, but no details regarding the exact analysis.


## Functional preprocessing

### Minimal functional preprocessing
The function preprocessing module included the removal of first four volumes, motion correction (FSL's `MCFLIRT`), fieldmap distortion correction (FSL's `fsl_prepare_fieldmap` and `FUGUE`) and coregistration to the subject’s individual longitudinal anatomical space (FreeSurfer's `bbregister`). In more detail, the transformations derived from the latter three steps were combined into one and applied in a single step.
For further analysis and ICA-AROMA processing, the minimally preprocessed data were intensity normalized and smoothed with a 6mm Gaussian kernel (`fslmaths -kernel gauss 2.548`).
<!-- *This part of the analysis was described in the preregistration as "After removing the first four volumes, transforms for motion correction (FSL’s MCFLIRT), fieldmap distortion correction (based on fieldmap and FSL’s FUGUE) and coregistration to the subject’s individual anatomical space (using FREESURFER’s bbregister) are calculated."*   -->

### ICA-AROMA preprocessing   
We used ICA-AROMA for fMRI denoising as it provides an acceptable trade-off between the mitigation of motion-FC correlation and the introduction of a distance-dependence on motion-FC relationship [@Parkes_2018]. As described in [@Pruim2015], the minimally preprocessed data was processed with independent component analysis (ICA) using FSL's `melodic` and nuisance components were classified according to four spectral and spatial criteria. Finally, the timeseries of the  nuisance components were regressed from the raw fMRI timeseries.
As recommended in the original paper, we performed regression of WM and CSF signal on the ICA-AROMA result. We used CompCor to estimate 5 variance components from a combined WM and CSF mask, which was further eroded using `fslmaths -nan -thr 0.99 -ero -bin` [@Behzadi_2007;@Muschelli_2014]. After regression of these nuisance components from the data, we performed high-pass filtering at 0.01 Hz.
*This analysis was described in the preregistration as "Then we will employ state-of-the art nuisance regression (i.e. ICA-AROMA with compCor regression (CC) and, optionally global signal regression (GSR) (Ciric et al., 2017; Parkes et al., 2018) to reduce the effect of physiological noise and head motion on the connectivity estimates."*  


### Global Signal regression   
@Ciric_2017 showed that GSR is very efficient in removing the correlation of head motion and FC, and outperforms ICA-AROMA alone. Yet, it introduces spatial dependency and spurious correlations. Previously, we reported on head motion differences between groups over time in this study [@Beyer_2020], and thus it was very important to minimize the motion-FC correlation. The global signal was derived from the average of all voxels in the brain mask. Then, we regressed WM and CSF CompCor components along with the GS from the ICA-AROMA fMRI data and high-pass filtered the resulting file as above.
*In the preregistration we stated " As global signal regression is very efficient in removing the correlation of head motion and connectivity dependence, but introduces spatial dependency and spurious correlations, we perform GSR after ICA-AROMA in a separate sensitivity analysis."*

### Functional connectivity
To derive reward and DMN functional connectivity maps, we used Nucleus Accumbens (Nacc) and precuneus as seed regions of interest (ROI), respectively. Based on FreeSurfer's `aseg.mgz` and Desikan-Killiany parcellation, we created seed masks using `mri_binarize` (thresholded for NAcc at 26,58; precuneus at 1025,2025) and averaged them over hemispheres. Then, we used `NiftiLabelsMasker` and `NiftiMasker` to extract the standardized timeseries from the seed regions and the whole brain. We calculated the Pearson's correlation between them with `numpy.dot`, performed r-to-z transform and saved the resulting correlation maps for each processing mode (minimally preprocessed, aroma+cc, aroma+gsr). Finally, the connectivity maps were transformed into MNI space using the affine transformation and non-linear warp derived with ANTS during anatomical preprocessing.
<!-- *In the preregistration we stated "Resting-state functional connectivity (FC) using seed-based connectivity analysis extracted with in-house pre-processing pipelines (see (Beyer et al., 2019)): Whole-brain FC maps for a priori defined seed regions (defined based on the results of the subcortical segmentation and Desikan-Killiany cortical parcellation in the Freesurfer version 6.0.0 longitudinal processing stream). For the reward network a ROI combined from bilateral Nucleus accumbens from the subcortical segmentation (26, Left-Accumbens-area, 58, Right-Accumbens-area) was selected. Ventro-medialprefrontal cortex was not selected as seed region due to low signal-to-noise ratio in this part of the brain in many participants (noticed during quality checking). For the default mode network, the seed region was combined from bilateral precuneus from the Desikan-Killiany atlas (1025 ctx-lh-precuneus, 2025 ctx-rh-precuneus). We will calculate  voxel-wise seed-based connectivity mapsin the individual subject’s space (which is coregistered to the Freesurfer longitudinally preprocessed timepoint) and apply r-to-Z-transform to these images. These steps will be performed using nilearn, nipype and python. Then, we will transform the connectivity maps into MNI space with a non-linear warp derived from anatomical preprocessing of the longitudinally preprocessed timepoints (using ANTS).* -->

### Quality Assessment

#### Anatomical Quality control

FreeSurfer cross-sectional and longitudinal  segmentations were visually checked according to @Klapwijk_2019. We excluded 5 datasets from 3 participants because of excessive head motion leading to failed pial reconstruction and anatomical-functional coregistration .
<!--ADI009_fu2, ADI063_bl, ADI063_fuADI116_bl, ADI116_fu, ADI116_fu2-->
<!-- *In the preregistration we stated that "Freesurfer segmentations and surfaces will be visually controlled and corrected according to published recommendations, if necessary", and that "We will exclude participants in which head motion artifacts affected the T1-weighted image preprocessing (e.g. caused Freesurfer to fail or perform very poorly (rated “Failed” according to (Klapwijk et al., 2019)".* -->

#### Functional Quality control
Resting state fMRI data quality control was performed along the protocol of @Ciric_2018.
As the expected average head motion is high in this sample [@Beyer_2020], it is difficult to determine an appropriate exclusion threshold which does not lead to the exclusion of a high number of individuals. Thus, we did not exclude any participants based on mean framewise displacement estimates beyond those who failed the anatomical preprocessing. We applied best-practice motion correction (ICA-AROMA and CC, plus optionally GSR) and monitored the reduction of motion-related artifact according to current recommendations [@Ciric_2018]. In addition, for models showing a significant time-by-group interaction, we performed a sensitivity analysis excluding the 10% data sets with highest mean FD (mFD).
On the single-subject level, we used `plot_carpet` from `niworkflows.viz.plots` to generate carpet plots which depict denoising quality. Figure \@ref{carpet_plot} shows an exemplary carpet plot with (from top to bottom): DVARS (spatial root mean square of the data after temporal differencing), mFD, percent outliers defined by AFNI `OutlierCount`, voxelwise timeseries from minimally preprocessed, AROMA non-aggressive and aggressive denoising, CC and CC + GSR data. All carpet plots were visually checked and if there was still structured noise in the CC+GSR-denoised functional data (such as black/white stripes, signal dropout), the participant was given a rating of 1 in `QA residuals`.
We evaluated mFD-FC relationships by computing a functional connectome based on [@Power_2012]. In more detail, we used the MNI coordinates of 246 cortical and subcortical spherical seed regions with 5mm radius in `NiftiSpheresMasker`, and calculated the Spearman rank correlation between these time series. Then, we correlated mean FD and QC values for each node across participants, and plotted the resulting mFD-FC correlation values in histogram (see Figure \@ref{example_FC}. We reported the mFD-FC correlation per preprocessing scheme.
Further, we evaluated the distance-dependence of mFD-FC correlations by correlating the euclidean distance between nodes with the mFD-QC correlation and report mean, median and standard deviations of mFD, DVARS and number of outliers over all participants.

### Aggregated FC values
To extract aggregated FC values, we first calculated the mean DMN and reward networks over all participants and timepoints, adjusted for age and sex. We used global signal regressed data as input and clusterwise bootstrapping with N=999. Network masks were formed from all voxels within clusters which survived a clusterwise multiple comparison correction of p_FWE < 0.05. We extracted the average connectivity from these masks for all data points.

<!-- *In the preregistration we wrote: "We will use the average of connectivity values within masks of the respective networks as aggregate network connectivity measure. The mask will include all voxels surviving FWE-correction of p<0.05 in a one-sample t-test of the individual connectivity maps across all participants and time points, calculated with the modified SwE option in the SwE toolbox"* -->

## Analysis

Statistical analysis were performed in MATLAB version 9.7.0.1190202 (R2019b, @MATLAB2018) using the SwE toolbox version 2.2.2 [@Guillaume_2014] as implemented in the Statistical Parametric Mapping software (SPM12.7770, @spm12)<!-- spm_check_installation('rev') -->, and R version 3.6.1 [@team2013r].
During analyses an implicit mask and an explicit mask were used. For this, FSL's standard space the brain mask that corresponds th "152 nonlinear 6th generation" atlas was re-sampled to 3 x 3 x 3 mm$^3$.<!-- MNI ICBM 2009a Nonlinear Symmetric grey matter mask ([http://www.bic.mni.mcgill.ca/ServicesAtlases/ICBM152NLin2009](http://www.bic.mni.mcgill.ca/ServicesAtlases/ICBM152NLin2009)) were re-sampled to 3 x 3 x 3 mm$^3$ and binarized at threshold $0.5$. -->

<!-- MODEL SETUP --> As specified in the preregistration, we tested the interaction of time and group: $FC = group + time + group*time$. Unlike prespecified, we did not include the model without covariates (as this is deprecated \@ref{nuisance_paper}). Instead, we calculated a model adjusting for age and sex (Model 1) and another model additionally adjusting for mean FD (Model 2). We did not adjust for baseline BMI as described in the preregistration, but explored the relationship with BMI in a separate analysis.
The model was examined for the correlation maps of two different seed regions (NAcc / PCC), and for the purpose of comparison for correlation maps of two different preprocessing pipelines (only AROMA+CC / with GSR)), with two different covariate sets (with/ without mean FD), resulting in $8$ a priori planned analyses.

Initially, analyses were run with a brain mask but after post hoc considerations detailed below, models were re-run with a grey matter mask which reduced the number of tests (voxels of interest) from $52378$ to $29451$. As a result a total of $32$ different analyses were performed.
Computation with the grey matter mask were exploratory and deviate from the preregistration.
The second model on the influence of between-subject differences in average BMI and longitudinal within-subject change in BMI was specified as follows: $FC = between-subject BMI + within-subject BMI$.

<!-- MODEL SPECIFICATION --> The marginal model implemented via the SwE toolbox implicitly accounts for random effects without the need to specify them through the error term. It therefore accommodates any repeated measurement covariance structures. <!-- Prereg: During the model specification, we will select the modified sandwich estimator (SwE) approach. Thus, we will define the groups and visits as binary numeric values and subject IDs as numeric values, matching the input order of the images. -->We used a modified SwE assuming different covariance structures for the intervention and the control group because of their unbalanced sample size, so heteroscedasticity would be considered.

<!-- DESIGN MATRIX, vielleicht beide auch als Abbildung kurz zeigen? --> For the first model, time was introduced as factor because we did not assume strict linearity for the increase in connectivity and therefore refrained from modeling time as continuous variable (see Figure \@ref(fig:figDesignmatrix)). The resulting factorial design <!-- check: flexible factorial? --> contained one regressor for each time point per group.
```{r figDesignmatrix, fig.align = 'center', fig.ncol = 2, out.width = "50%", fig.subcap=c('Design matrix with time as categorial factor.','Design matrix with time as continuous variable.'), fig.cap="Possible design matrices of time-by-group model.", echo=FALSE}
# fig.show="hold",  out.width="40%", fig.height = 8,

DesignMatricesList <- readRDS(file = "../report/fig/DesignMatricesList.rds")
DesignMatricesList$plotA
DesignMatricesList$plotB
#gridExtra::grid.arrange(plotA, plotB, nrow=1)
```
For the second and third model, we calculated the centered mean BMI and log mean FD per subject and the intra-subject-centered BMI as proposed by @Guillaume_2014. With a model containing average BMI and longitudinal change per subject, we investigated their differential effects on the complete sample and subsequently in a exploratory fashion for the intervention group only as the effect of longitudinal change in BMI was expected to be driven by this subsample.
<!-- NUISANCE COVARIATES --> Baseline age, sex, and log mean framewise displacement (FD) were entered into the first and second model as nuisance variables. Age and sex were between-subject covariates while FD is time-varying. Mean FD was log-transformed and age was demeaned by subtracting the overall mean across subjects and time points.
As change in FD and change in BMI share common variance [@Beyer_2019], the inclusion of log mean FD may be disputed and done optionally. For that reason, we performed each analysis separately one with mean FD (three and without. Differences in results will be reported. We consider this sensitivity analysis theoretically more meaningful than the preregistered comparison with the nuisance covariate free model and a model with four nuisance covariates (including baseline BMI).<!-- Prereg: We will perform sensitivity analysis adjusting for baseline age, sex, average of mean FD of both time points and baseline BMI -->
<!-- POST HOC  --> For a better understanding of the unique contribution of average and longitudinal change FD measures, we separately employed a third post-hoc model to disentangle the effects: $FC = between-subject FD + within-subject FD$ with nuisance covariates age and sex. As these post-hoc analyses were not preregistered, they should be considered to be exploratory.

<!-- INFERENCE --> To ensure robustness of our results, we computed estimates with non-parametric test using Wild bootstrap with an unrestricted SwE on all contrasts of interest for clusterwise inference.
Type C2 for small sample bias adjustment is applied before the bootstrap resampling as recommended in the SwE manual.
In contrast to the parametric estimation, Wild Bootstrap avoids any parametric distributional assumptions (e.g. random field theory), and is unlike permutation based framework appropriate<!-- permutations don't work with multilevel data (dependencies)--> for longitudinal data.
Unlike the description in the preregistration, we used a cluster forming threshold of $p < 0.001$ for a more multiple comparison adjustment (instead of $p < 0.01)$, and $1000$ bootstraps due to required computation time (instead of 5000). Significant clusters are defined as family-wise error (FWE) corrected $p < 0.05$. The anatomical localization of significant clusters was investigated with the SPM Anatomy toolbox, version 2.2c [@Eickhoff_2005].<!-- Prereg: We will use Type 3 small samples bias adjustment and “Approx” option for estimating the degrees of freedom. We will use the Non-Parametric Wild Bootstrap approach with default parameters, 5000 bootstraps and clusterwise inference (cluster forming threshold of p<0.01). Significant clusters are defined as family-wise error - corrected p<0.05. -->

<!-- R analysis of aggregated values -->
We analyzed the aggregate connectivity values using linear mixed models in the R package lme4 [@Bates_2007].
Following the preregistration, we first investigated a time-by-group interaction between baseline and follow-up.
We used a model comparison of R1 and R0 models with `anova`:
`R1= lmer(agg FC ~ timepoint*group + (1|subj))`
`R0 = lmer(agg FC ~ timepoint + group + (1|subj))`
We performed a sensitivity analysis adjusting for baseline age, sex, average of mean FD of both time points and baseline BMI. Again, the time-by-group point interaction was considered significant if a model comparison between R1 and Null models using `anova` function yielded a $p < 0.05$.
Finally, we estimated the above-mentioned interaction model for all three time points. Again, the interaction was considered significant if a model comparison between R1 and R0 using `anova` had $p < 0.05$.

\newpage
# Results

## Quality control
We performed different quality controls for the rsfMRI data.
As described in @Beyer_2020, group and time show an interaction effect for mFD where the intervention group reduced in head motion in the follow-up assessments compared to the control group.
We also inspected DVARS, a measure of whole-brain signal variation which is reflective of noise in the data. We saw that DVARS did not qualitatively differ between groups and time points, and that the correlation of DVARS and mFD remained similar over time points.
This indicates that even though there was a decrease in head motion in the intervention versus control group, the impact of head motion on imaging data remained similar over the study period.

```{r mFDFC, echo=FALSE}
res <- read.csv("../report/FDFCcorrelations.csv")
```

```{r tableQcfc, echo=FALSE}
tab_Qcfc <-
  knitr::kable(
    round(res, 3),
    col.names = colnames(res),
    row.names = TRUE,
    format = "latex",
    booktabs = T,
    linesep = "",
    caption = "Summary of quality metrics for different denoising pipelines across conditions and time points"
  ) %>%
  column_spec(c(2:6), width = "1.8cm")
tab_Qcfc
```

Further, we evaluated the impact of our denoising pipelines on different quality metrics following [@Ciric_2018]. Table \@ref(tab:tableQcfc) shows that in the minimally preprocessed data, mFD and FC between nodes was significantly positively correlated (mean Spearman's r = `r round(res[1,1],2)`). This relationship was negatively associated with distance between nodes (mean Spearman's r = `r round(res[1,5],2)`).  
Denoising procedures (AROMA, AROMA+CC, AROMA+CC+GSR) gradually reduced the correlation of mFD and connectivity, and reduced the distance dependency. Contrary to previous reports, GSR did not exercabate mFD-FC distance dependency. Overall, AROMA+CC+GSR performed best, with almost no mFD-FC correlation (mean Spearman's r = `r round(res[4,1],2)`), and minimal positive distance dependence (mean Spearman's r = `r round(res[4,5],2)`). Yet, AROMA+CC also performed well, and we thus calculated our analysis models for both preprocessing schemes.

```{r figDvarsmFD, fig.align = "center", out.width="100%", fig.cap='Summary of quality measures DVARS and mFD', echo=FALSE}

figList <- readRDS(file = "../report/fig/figDvarsmFDList.rds")
(figList$fig1 | figList$fig2) / figList$fig3
```

```{r figNetworks, echo=FALSE, out.width="49%", out.height="30%", fig.cap="Resting state networks based on AROMA+CC+GSR input data, one-sample t-tests adjusting for age and sex over all timepoints and participants with bootstrapped clusterwise inference (p FWE<0.05)", fig.subcap=c("DMN seeded from precuneus", "Reward network seeded from Nucleus Accumbens"),fig.show='hold',fig.align='center'}
#setwd(knitr::opts_knit$get("root.dir"))
networks = c("../report/fig/DMN_thresholded_for_clusterFWE005.pdf",
             "../report/fig/Rew_thresholded_for_clusterFWE005.pdf")
knitr::include_graphics(networks)
```

Figure \@ref{fig:figNetworks} shows the DMN and reward network which we used for extracting the aggregated FC values. Both networks included the typically described brain regions (i.e. medial prefrontal cortex, parietal lobules and posterior hippocampus for the DMN, and anterior cingulate, right amygdala and ventromedial-prefrontal cortex for the reward network).


```{r figtSNR,fig.cap="Lower tSNR in the region of interest NAcc versus precuneus used for seed-based connectivity (shown are all 101 timepoints)", out.width="60%", fig.align="center", echo=FALSE}
readRDS(file = "../report/fig/fig_tSNR.rds")
```
Yet, the reward network was less pronounced (overall lower T-values) and symmetric (no significant connectivity with left amygdala), which might be due to lower SNR in the seeded brain region (see Figure \@ref{fig:figtSNR}.

## Interaction effect of intervention and time (preregistered analysis)

### DMN/reward network with whole brain mask (preregistered analysis)

#### with adjustment for age, sex, meanFD
There was no interaction of group and time point regarding the resting state connectivity for neither the PCC nor the NAcc as was hypothesized. Nor was there a significant main effect for any of the covariates of interest (time, group) in clusterwise inference with FWE correction.

#### with adjustment for age and sex
Similarly, there were only non-findings when reducing the number of nuisance covariates by leaving out mean FD. Results did not differ between analyses of connectivity maps from different preprocessing pipelines.
<!-- There was no other significant co-activation for any other region of interest for neither of the preprocessing variants. -->


<!-- Neurovault -->
Unthresholded maps for the t-tests of the DMN and reward network (which were used for data aggregation) as well as contrasts of group, time and group-by-time interaction are on [NeuroVault](insert link here).

## Interaction effect group by time on aggregated FC (preregistered analysis)
```{r load agg FC data and prepare, echo=FALSE}
final_FC <- read.csv("../report/final_FC.csv")
```

### DMN for two timepoints
```{r vif for models, echo=FALSE}
test_vif=lm(mean_DMN_conn ~ tp + group_factor + Age_BL + Sex + mean.logmFD, data=final_FC)
vif_res=vif(test_vif)
```

```{r calc DMN two tp,results = 'asis', echo = FALSE}
R1 = lme4::lmer(mean_DMN_conn ~ tp*group_factor + (1|subj.ID), data=final_FC[final_FC$tp!="fu2",])
R0 = lme4::lmer(mean_DMN_conn ~ tp + group_factor + (1|subj.ID), data=final_FC[final_FC$tp!="fu2",])
anvDMN2tp=anova(R1,R0)
```

```{r DMN2tp results, caption="DMN connectivity compared bl to fu", results="asis", echo=FALSE}
#tab_model(R1,R0)
texreg(list(R0,R1), custom.model.names = c("R0", "R1"), float.pos = "h",  custom.coef.names=c("Intercept (BL, NBARS)", "Timepoint FU", "Group BARS", "Timepoint x Group"),  center = TRUE, digits = 3, leading.zero = FALSE, single.row = TRUE, include.adjrs = FALSE, include.bic = FALSE, table = FALSE, use.packages = FALSE)
```

### DMN for two timepoints, adjusted for age, sex, mean FD
```{r calc DMN two tp adjusted, eval = TRUE, echo = FALSE}
R1 = lme4::lmer(mean_DMN_conn ~ tp*group_factor + Age_BL + Sex + logmFD +(1|subj.ID), data=final_FC[final_FC$tp!="fu2",])
R0 = lme4::lmer(mean_DMN_conn ~ tp + group_factor + Age_BL + Sex + logmFD +(1|subj.ID), data=final_FC[final_FC$tp!="fu2",])
anvDMN2tpadj=anova(R1,R0)
res=summary(R1)
#tab_model(R0,R1)
```

```{r DMN2tpadj results, caption="DMN connectivity compared bl to fu", results="asis", echo=FALSE}
#tab_model(R1,R0)
texreg(list(R0,R1), reorder.coef=c(1, 2, 3, 7, 4, 5, 6),custom.coef.names=c("Intercept (BL, NBARS)","Timepoint FU", "Group BARS", "Age", "Sex","mean FD","Timepoint x Group"), custom.model.names = c("R0", "R1"), float.pos = "h",  center = TRUE, digits = 3, leading.zero = FALSE, single.row = TRUE, include.adjrs = FALSE, include.bic = FALSE, table = FALSE, use.packages = FALSE)
```

### DMN for three timepoints, adjusted for age, sex, mean FD
```{r calc DMN three tp, eval = TRUE, echo = FALSE}
R1 = lme4::lmer(mean_DMN_conn ~ tp*group_factor + Age_BL + Sex + mean.logmFD +(1|subj.ID), data=final_FC)
R0 = lme4::lmer(mean_DMN_conn ~ tp + group_factor + Age_BL + Sex +mean.logmFD +(1|subj.ID), data=final_FC)
anvDMN3tp=anova(R1,R0)
```

```{r DMN3tp results, caption="DMN connectivity compared bl to fu", results="asis", echo=FALSE}
#tab_model(R1,R0)
texreg(list(R0,R1), reorder.coef=c(1, 2, 3, 4, 8,9,5,6,7),custom.coef.names=c("Intercept (BL, NBARS)", "Timepoint FU", "Timepoint FU2", "Group BARS", "Age", "Sex","mean FD","Timepoint FU x Group", "Timepoint FU2 x Group"), custom.model.names = c("R0", "R1"), float.pos = "h",  center = TRUE, digits = 3, leading.zero = FALSE, single.row = TRUE, include.adjrs = FALSE, include.bic = FALSE, table = FALSE, use.packages = FALSE)
```

```{r figDMNconn, echo=FALSE}
readRDS(file = "../report/fig/figDMNconn.rds")
```

### Reward network for two time points
```{r calc rew two tp, eval = TRUE, echo = FALSE}
R1 = lme4::lmer(mean_Rew_conn ~ tp*group_factor + (1|subj.ID), data=final_FC[final_FC$tp!="fu2",])
R0 = lme4::lmer(mean_Rew_conn ~ tp + group_factor + (1|subj.ID), data=final_FC[final_FC$tp!="fu2",])
anvRew2tp=anova(R1,R0)
```

```{r Rew2tp results, caption="DMN connectivity compared bl to fu", results="asis", echo=FALSE}
#tab_model(R1,R0)
texreg(list(R0,R1), custom.coef.names=c("Intercept (BL, NBARS)","Timepoint FU", "Group BARS", "Timepoint x Group"), custom.model.names = c("R0", "R1"), float.pos = "h",  center = TRUE, digits = 3, leading.zero = FALSE, single.row = TRUE, include.adjrs = FALSE, include.bic = FALSE, table = FALSE, use.packages = FALSE)
```

### Reward network for two timepoints, adjusted for age, sex, mean FD
```{r calc rew two tp adjusted, eval = TRUE, echo = FALSE}
R1 = lme4::lmer(mean_Rew_conn ~ tp*group_factor + Age_BL + Sex + logmFD +(1|subj.ID), data=final_FC[final_FC$tp!="fu2",])
R0 = lme4::lmer(mean_Rew_conn ~ tp + group_factor + Age_BL + Sex +logmFD +(1|subj.ID), data=final_FC[final_FC$tp!="fu2",])
anvRew2tpadj=anova(R1,R0)
```
```{r Rew2tpadj results, caption="DMN connectivity compared bl to fu", results="asis", echo=FALSE}
#tab_model(R1,R0)
texreg(list(R0,R1), reorder.coef=c(1, 2, 3, 7, 4, 5, 6),custom.coef.names=c("Intercept (BL, NBARS)","Timepoint FU", "Group BARS", "Age", "Sex","mean FD","Timepoint x Group"), custom.model.names = c("R0", "R1"), float.pos = "h",  center = TRUE, digits = 3, leading.zero = FALSE, single.row = TRUE, include.adjrs = FALSE, include.bic = FALSE, table = FALSE, use.packages = FALSE)
```

### Reward network for three timepoints, adjusted for age, sex, mean FD
```{r calc rew three tp, eval = TRUE, echo = FALSE}
R1 = lme4::lmer(mean_Rew_conn ~ tp*group_factor + Age_BL + Sex + logmFD +(1|subj.ID), data=final_FC)
R0 = lme4::lmer(mean_Rew_conn ~ tp + group_factor + Age_BL + Sex +logmFD +(1|subj.ID), data=final_FC)
anvRew3tp=anova(R1,R0)
```
```{r Rew3tp results, caption="DMN connectivity compared bl to fu", results="asis", echo=FALSE}
#tab_model(R1,R0)
texreg(list(R0,R1), reorder.coef=c(1, 2, 3, 4, 8,9,5,6,7),custom.coef.names=c("Intercept (BL, NBARS)", "Timepoint FU", "Timepoint FU2", "Group BARS", "Age", "Sex","mean FD","Timepoint FU x Group", "Timepoint FU2 x Group"), custom.model.names = c("R0", "R1"), float.pos = "h",  center = TRUE, digits = 3, leading.zero = FALSE, single.row = TRUE, include.adjrs = FALSE, include.bic = FALSE, table = FALSE, use.packages = FALSE)
```

```{r figRewconn, echo=FALSE}
readRDS(file = "../report/fig/figRewconn.rds")
```

## Effect of mean and change in BMI (exploratory analysis)

Next, we tested for significant effects of the average BMI and the individual change in BMI longitudinally across the three time points.
<!-- ### DMN -->
<!-- #### DMN for three timepoints -->
<!-- cc -->Using the images preprocessed with AROMA+CC, we did find a significant co-activation with the PCC in three clusters associated with average BMI. Omitting mean FD as nuisance covariate yielded similar results but four significant clusters. However, in both, there is significant peak activation within the largest cluster.
<!-- gsr -->In analyses on images that were additionally preprocessed with GSR, no cluster survived statistical thresholds for either ROI.
All results with significant cluster co-activation are depicted in Table \@ref(tab:tableBMImodel).

```{r "BMIagesexfd_PCCcc_avgBMI_deact", out.width = "50%"}
knitr::include_graphics("../report/fig/BMIagesexfd_PCCcc_avgBMI_deact.pdf")
```

```{r "BMIagesex_PCCcc_avgBMI_deact", out.width = "85%"}
knitr::include_graphics("../report/fig/BMIagesex_PCCcc_avgBMI_deact.pdf")
```

## Effect of FD (exploratory analysis)

To investigate the unique contributions of the average value of and the longitudinal change in mean FD, we constructed two additional models.
First, BMI measures are excluded from the design matrix. Covariance of the mFD and outcome meausres is investigated by splitting mFD into average mFD and longitudinal mFD change and by inspecting associations with each predictor. Age and sex were nuisance covariates.
<!-- #### Reward -->
As shown in Table \@ref(tab:tableFDmodel), there is a significant co-activation of one cluster with the NAcc. Cluster co-activation appeared irrespective of the preprocessing procedure, differing mainly in cluster size.
<!-- ### DMN -->
We did not find a any clusters for functional connectivity with the PCC.
```{r "FDagesex_NACCcc_avgFD_act", out.width = "75%"}
knitr::include_graphics("../report/fig/FDagesex_NACCcc_avgFD_act.pdf")
```

```{r "FDagesex_NACCgsr_avgFD_act", out.width = "75%"}
knitr::include_graphics("../report/fig/FDagesex_NACCgsr_avgFD_act.pdf")
```

## Effect of BMI and FD (exploratory analysis)

Average BMI and change in BMI remain covariates of interest. While initially used as nuisance covariate, here, mFD is split into average mFD and change in mFD and used as. Age and sex remain nuisance covariates.

<!-- ### Reward -->
<!-- cc -->There is a significant effect of change in BMI on functional connectivity between NAcc and one cluster in the posterior-medial frontal region.
Voxel activation at local maximum within this cluster was significant at peak level after FWE-correction. Furthermore, the functional connectivity between the NAcc and one cluster was significantly related to average mFD.
<!-- gsr -->When running the model with images corrected with GSR, the associations between connectivity and change in BMI did not survive statistical thresholds.
On the other hand, the relationship with average mFD was confirmed by analyses after GSR but cluster size shrank.

<!-- ### DMN -->
```{r tableBMImodel}
# do not change chunk label as it corresponds to the manually defined (in table.R) table label
tab_BMImodel <- readRDS(file = "../report/tab/FCTableList.rds")[[1]]
tab_BMImodel
```

```{r tableFDmodel}
# do not change chunk labelsas it corresponds to the manually defined (in table.R) table label
tab_FDmodel <- readRDS(file = "../report/tab/FCTableList.rds")[[2]]
tab_FDmodel
```

```{r tableBMIFDmodel}
# do not change chunk label as it corresponds to the manually defined (in table.R) table label
tab_BMIFDmodel <- readRDS(file = "../report/tab/FCTableList.rds")[[3]]
tab_BMIFDmodel
```
<!-- cc -->The effect of average BMI on connectivity between the PCC and other regions reported previously is confirmed. There is a significant association between average BMI and the connectivity between PCC and three other clusters. Results are detailed in Table \@ref(tab:tableBMIFDmodel).
Test statistics of these clusters differ only slightly from the effect found for average BMI when using mFD as nuisance covariate.
<!-- gsr -->As before, the effect did not survive when thresholding if the images had been GSR corrected.
```{r "BMIFDagesex_NACCcc_avgFD_act", out.width = "75%"}
knitr::include_graphics("../report/fig/BMIFDagesex_NACCcc_avgFD_act.pdf")
```

```{r "BMIFDagesex_NACCcc_cgnBMI_deact", out.width = "75%"}
knitr::include_graphics("../report/fig/BMIFDagesex_NACCcc_cngBMI_deact.pdf")
```

```{r "BMIFDagesex_NACCgsr_avgFD_act", out.width = "75%"}
knitr::include_graphics("../report/fig/BMIFDagesex_NACCgsr_avgFD_act.pdf")
```

```{r "BMIFDagesex_NACCgsr_cgnBMI_deact", out.width = "75%"}
knitr::include_graphics("../report/fig/BMIFDagesex_NACCgsr_cngBMI_deact.pdf")
```

```{r "BMIFDagesex_PCCcc_avgBMI_deact", out.width = "75%"}
knitr::include_graphics("../report/fig/BMIFDagesex_PCCcc_avgBMI_deact.pdf")
```


## Effect on hypothalamic connectivity (exploratory analysis)
...

<!-- Neurovault -->
Unthresholded maps for the t-tests as well as contrasts of average BMI and change BMI of the main model, and post-hoc contrasts for average FD and change FD will be are published on NeuroVault.

# Discussion

#### Summary
Utilizing resting-state functional MRI on morbidly obese individuals that either underwent or awaited bariatric surgery over the course of one year.
<!-- general --> Building on the evidence for post-surgery changes in functional activity, this study explored the longitudinal relationship between surgery-induced weight loss and functional integrity in target networks indicated by resting-state functional connectivity. Over the course of one year we collected neuroimaging and anthropometric data from `r cs["Sum","IG"]` morbidly obese patients undergoing bariatric surgery and compared them to the longitudinal data of  `r cs["Sum","KG"]` patients on the waiting list.
<!-- model specific --> Looking at time-by-group interactions, we primarily investigated whether changes in functional connectivity over time vary depending whether participants have received surgery or not, while controlling for individual variance in resting-state connectivity over time and at baseline. Beyond that, main effects of the intervention and of the time were examined.
The second model further investigates if changes in connectivity are a function of an average BMI (controlled for individual variance in BMI) and the longitudinal change in BMI.
<!-- sensitivity analyses -->To get a better understanding of our results, we conducted multiverse exploratory analyses representing different choices regarding preprocessing pipelines, inclusion of covariates and subsets of the data relevant for interpretation.

#### Support of original hypotheses
<!-- false positive -->
To summarize, while our primary hypothesis on group time interactions could not be confirmed, there was a significant relationship between functional activation
and the continuous BMI measures for some but not all analyses.

- DMN: average BMI but only with lenient AROMA-CC but then for both covariate structures age/sex/mFD and age/sex; effect stable when separating avg mFD and cgn FD into two regressors
- Reward: effect of change BMI only when separating mFD, bit high peak activation
The individuals BMI averaged across measures taken throughout the one-year period negatively correlated with functional connectivity between PCC and [regions from clusters]. Results indicate a decrease a functional connectivity within the default mode network.
<!-- discuss consistency with previous literatur -->
... not? in accordance with our hypothesis regarding network activity changes.


Regarding the reward network, we could not predict changes in functional connectivity with the preregistered models.
However, when investigating the unique contributions to variance of head motion measures and BMI measures, we detected a significant relationship between the individuals' change in BMI throughout the year.
This may be preliminary evidence for changes in the functional connectivity between reward and frontal regions induced by weight-loss.
<!-- discuss consistency with previous literatur -->

In our sample, extend of micromovements of the head averaged across all measurements is associated with increased functional connectivity between reward and frontal regions. <!-- explanation? overlap with region from change in BMI? -->

<!-- Head motion as covariate, multicollinearity -->
Based on concerns expressed in the literature, we tried to closely inspect and rigorously control for the influence of head motion. The presence of multi-collinearity of our predictors has been established before [@Beyer_2019]. As described by @Monti_2011, in the presence of multicollinearity, the unique contribution of the regressor for the prediction cannot be disentangled.
Surprisingly, the effect of weight loss on the connectivity of the the NAcc with the posterior-medial frontal region is only present when separating average mFD and change in mFC and introducing two instead of one regressors into the model.
However, such unexpected findings would be in accordance with @Monti_2011 stating that <!-- not only will confidence in $\beta$ estimates suffer but  --> estimates can behave erratic depending on which regressors are included in the model.

Notwithstanding the difficulties of quantitatively disentangling multicollinearity between head motion and BMI, preliminary conclusions of our analyses may be...
<!-- Given the multiplicity of of models resulting from variations of inspected networks and sensitivity analysis for different preprocessing and correction approached, the obtained significant correlations between seed regions and voxels are likely to be false positive. Ventures to verify effects by re-calculating with non-parametric Wild bootstrap confirmed supported presumption as effects were not robust across estimation procedures. -->

<!-- limitations -->
Without an a priori power analysis it is not possible to determine if there is no effect or
To clarify, extended considerations should be made to use a priori power analysis (e.g. with fMRIpower) or check evidence of absence with alternative statistical procedures.

#### Similarity of results with literature (random notes)
Our results are not consistent with the present literature. Although there are few studies investigating the impact of bariatric surgery on functional connectivity at resting state, the present articles do significant changes in network activation [@;@;@].
<!-- publication bias -->

#### Interpretation (random notes)
<!-- absence of evidence --> However, hypotheses about the plasticity functional networks following bariatric surgery could not be validated. Due to the shortcomings of the inferential paradigm used, our null findings may either put conclusions drawn from previous research into question or may neither provide evidence for the presence nor the absence of the effect.
<!-- Control for satiety? --> A previous repeated measurement design with patients undergoing bariatric surgery and behavioral dietary intervention manipulating satiety showed a differential effect of satiety between intervention groups on the resting-state functional connectivity seeded in the precuneus. After the intervention, functional connectivity was higher in bariatric patients. It decreased after a meal while dietary patients showed an increase [@Lepping_2015].
prandrial state is a relevant factor when investigating spontaneous brain activity [@Wiemerslage_2016]. putamine, insula

<!-- GENERALIZABILITY -->
#### Internal validity
<!-- advantage: prospective intervention control study -->Common challenge in medical intervention studies is the difficulty to draw causal inference about the effect of interventions such as surgeries because randomization is often unethical or unfeasible as done in randomized control trials.
Previous studies have compared the sample of bariatric patients to lean individuals, behavioral dieters, or obese individuals without a recommendation for bariatric surgery.
Despite the accumulated evidence, effects may still be attributable to baseline differences, contributing factors to the condition or other psychophysiological and dispositional difference between groups [@].
In order to build upon and complement previous evidence, we aimed to isolate the impact of the surgical procedure on changes in resting-state connectivity to a maximum possible extent by conducting a prospective non-randomization trial study.
Such a study design is secondary to randomized control trials in regard to internal control by means of temporality and controllability.
We established temporality by contrasting pre- and post-surgery measures change while controlling for individual variance. <!-- Such longitudinal analyses support the validity of conclusions about the effects of the surgery. -->
The waiting list control group is equivalent in BMI, treatment history and  treatment recommendation and therefore allows controlling for concurrent factors [@Thiese_2014].
Incorporating these consideration, our study aimed at a higher internal validity for conclusions about the changes in functional connectivity specific to surgery-induced changes.

#### Study sample
<!-- advantage: representative sample -->
Size and composition of our sample did not allow separate analyses for the sexes. However, the disproportionate sex distribution is reflective prevalence differences and under-utilization of bariatric surgery by men [@Fuchs_2015; @Chooi_2019].

<!-- mention larger sample size -->

#### Marginal model
<!-- advantage: controlling for individual variance -->
Due to the limitation of the traditional ANOVA framework (with respect to the spherity assumption, handling missing data, handling continuous data), it is often recommended to use modern models such as mixed-effect models and marginal models [@Chen_2013;@Guillaume_2014;@McFarquhar_2019].
@McFarquhar_2019 demonstrated that specifying complex multi-level models and deriving the correct contrast weights with standard neuroimaging software packages such as SPM and FSL can be quite tedious and complicated if done appropriately.
<!-- However, for the purpose of comparison, we re-ran the analysis for the time-by-group--interaction with age and sex as nuisance covariates. We opted for a simplified model investigating the time-by group interaction in ... because different nuisance covariates, time-invariant or time-varying, create additional complications. An advantage of the time-by-group interaction in our model is that the $F$-ratio does not require partitioning the error and includes only factors and time-invariant nuisance convariates. The model was set up as flexible factorial design with factors "subject", "group", and "time" assuming unequal group variances. -->
<!-- Differences could be attributed to different corrections for non-spherity and assumptions on voxel covariance structures. Detailed comparisons between SPM12, SwE, and other software packages have been described elsewhere [@McFarquhar_2016]. -->
<!-- conclusion??? -->
Opposed to flexible factorial models, where each individual is modelled separately, marginal models are parsimonious and preserve more degrees of freedom.

<!-- IMPLICATIONS -->
<!-- Relevance of rsfMRI as biomarker -->


<!-- For all patients included, conservative obesity treatment had failed, e.g. behavioral diet intervention. As shown before, patients who were successful in behavioral diet increased connectivity in the default mode network. This might be indicative for self-referent information processing. -->

# Code availability

All code is available in the github repository [https://github.com/hsx1/adi2_rsfmri](https://github.com/hsx1/adi2_rsfmri). The code includes script for data preparation and analysis of different models.

# Declaration of interest
# Funding
# Acknowledgments

\newpage
# References
